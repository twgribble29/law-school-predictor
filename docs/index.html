<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law School Admissions Predictor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        header { text-align: center; margin-bottom: 40px; }
        h1 { color: #1a1a2e; font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1rem; }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e1e5e9;
            border-top: 4px solid #0f3460;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .form-section h2 {
            color: #1a1a2e;
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group { display: flex; flex-direction: column; }

        label {
            color: #444;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        input[type="number"], select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0f3460;
        }

        .checkboxes {
            display: flex;
            gap: 30px;
            margin-top: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-label input {
            width: 20px;
            height: 20px;
            accent-color: #0f3460;
        }

        .predict-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .predict-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(15, 52, 96, 0.3);
        }

        .predict-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        #results { margin-top: 40px; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header { text-align: center; margin-bottom: 30px; }
        .results-header h2 { color: #1a1a2e; margin-bottom: 10px; }
        #model-info { color: #666; font-size: 0.95rem; }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 25px;
            border-radius: 12px;
            color: white;
        }

        .stat-card.reach { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%); }
        .stat-card.target { background: linear-gradient(135deg, #ffd93d 0%, #f5c842 100%); color: #333; }
        .stat-card.safety { background: linear-gradient(135deg, #6bcb77 0%, #5cb868 100%); }

        .stat-value { font-size: 2.5rem; font-weight: 700; }
        .stat-label { font-size: 1rem; font-weight: 500; margin-top: 5px; }
        .stat-desc { font-size: 0.85rem; opacity: 0.9; margin-top: 5px; }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e1e5e9;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .filter-btn:hover { border-color: #0f3460; }

        .filter-btn.active {
            background: #0f3460;
            color: white;
            border-color: #0f3460;
        }

        table { width: 100%; border-collapse: collapse; }

        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #444;
            border-bottom: 2px solid #e1e5e9;
        }

        td { padding: 15px; border-bottom: 1px solid #e1e5e9; }
        tr:hover { background: #f8f9fa; }

        .prob-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .prob-badge.safety { background: #d4edda; color: #155724; }
        .prob-badge.target { background: #fff3cd; color: #856404; }
        .prob-badge.reach { background: #f8d7da; color: #721c24; }

        .category-label {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .category-label.safety { background: #6bcb77; color: white; }
        .category-label.target { background: #ffd93d; color: #333; }
        .category-label.reach { background: #ff6b6b; color: white; }

        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .disclaimer {
            text-align: center;
            color: #888;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 1.8rem; }
            .results-stats { grid-template-columns: 1fr; }
            .checkboxes { flex-direction: column; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Law School Admissions Predictor</h1>
            <p class="subtitle">Predict your chances at 193 ABA-accredited law schools</p>
        </header>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading prediction data...</p>
        </div>

        <div id="app" style="display: none;">
            <form id="prediction-form">
                <div class="form-section">
                    <h2>Your Profile</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="lsat">LSAT Score (140-180)</label>
                            <input type="number" id="lsat" min="140" max="180" value="165" required>
                        </div>

                        <div class="form-group">
                            <label for="gpa">GPA (2.5-4.0)</label>
                            <input type="number" id="gpa" min="2.5" max="4.0" step="0.1" value="3.5" required>
                        </div>
                    </div>

                    <div class="checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" id="urm">
                            <span>URM Status</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="predict-btn">Predict My Chances</button>
            </form>

            <div id="results" style="display: none;">
                <div class="results-header">
                    <h2>Your Predicted Admission Chances</h2>
                    <p id="model-info"></p>
                </div>

                <div class="results-stats">
                    <div class="stat-card reach">
                        <div class="stat-value" id="reach-count">0</div>
                        <div class="stat-label">Reach Schools</div>
                        <div class="stat-desc">&lt;30% chance</div>
                    </div>
                    <div class="stat-card target">
                        <div class="stat-value" id="target-count">0</div>
                        <div class="stat-label">Target Schools</div>
                        <div class="stat-desc">30-70% chance</div>
                    </div>
                    <div class="stat-card safety">
                        <div class="stat-value" id="safety-count">0</div>
                        <div class="stat-label">Safety Schools</div>
                        <div class="stat-desc">&gt;70% chance</div>
                    </div>
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All Schools</button>
                    <button class="filter-btn" data-filter="safety">Safety (&gt;70%)</button>
                    <button class="filter-btn" data-filter="target">Target (30-70%)</button>
                    <button class="filter-btn" data-filter="reach">Reach (&lt;30%)</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>School</th>
                            <th>Probability</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody id="results-body"></tbody>
                </table>
            </div>
        </div>

        <footer>
            <p class="disclaimer">
                Predictions are estimates based on historical data from LSD.Law (2003-2025).<br>
                Model accuracy: ~90% AUC. Actual admissions depend on many factors not captured here.
            </p>
        </footer>
    </div>

    <script>
        let predictionsNonUrm = null;
        let predictionsUrm = null;
        let schools = null;

        // Load data
        async function loadData() {
            try {
                const [nonUrmRes, urmRes, schoolsRes] = await Promise.all([
                    fetch('predictions_non_urm.json'),
                    fetch('predictions_urm.json'),
                    fetch('schools.json')
                ]);

                predictionsNonUrm = await nonUrmRes.json();
                predictionsUrm = await urmRes.json();
                schools = await schoolsRes.json();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
            } catch (error) {
                document.getElementById('loading').innerHTML =
                    '<p style="color: #ff6b6b;">Error loading data. Please refresh the page.</p>';
                console.error('Error loading data:', error);
            }
        }

        loadData();

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;
                document.querySelectorAll('#results-body tr').forEach(row => {
                    if (filter === 'all') {
                        row.style.display = '';
                    } else {
                        row.style.display = row.dataset.category === filter ? '' : 'none';
                    }
                });
            });
        });

        // Form submission
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault();

            let lsat = parseInt(document.getElementById('lsat').value);
            let gpa = parseFloat(document.getElementById('gpa').value);
            const isUrm = document.getElementById('urm').checked;

            // Clamp values
            lsat = Math.max(140, Math.min(180, lsat));
            gpa = Math.max(2.5, Math.min(4.0, Math.round(gpa * 10) / 10));

            // Get predictions
            const predictions = isUrm ? predictionsUrm : predictionsNonUrm;
            const gpaKey = gpa.toFixed(1);

            if (!predictions[lsat] || !predictions[lsat][gpaKey]) {
                alert('Invalid LSAT or GPA value. Please use LSAT 140-180 and GPA 2.5-4.0.');
                return;
            }

            const schoolPredictions = predictions[lsat][gpaKey];

            // Build results array
            const results = schools.map((school, idx) => ({
                rank: idx + 1,
                name: school.name,
                probability: schoolPredictions[school.name] || 0,
                selectivity: school.selectivity
            }));

            // Sort by probability descending
            results.sort((a, b) => b.probability - a.probability);

            // Count categories
            let reach = 0, target = 0, safety = 0;
            results.forEach(r => {
                if (r.probability >= 70) safety++;
                else if (r.probability >= 30) target++;
                else reach++;
            });

            document.getElementById('reach-count').textContent = reach;
            document.getElementById('target-count').textContent = target;
            document.getElementById('safety-count').textContent = safety;

            document.getElementById('model-info').textContent =
                `LSAT: ${lsat} | GPA: ${gpa.toFixed(1)} | ${isUrm ? 'URM' : 'Non-URM'}`;

            // Render table
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '';

            results.forEach((r, idx) => {
                let category, categoryClass;
                if (r.probability >= 70) {
                    category = 'Safety';
                    categoryClass = 'safety';
                } else if (r.probability >= 30) {
                    category = 'Target';
                    categoryClass = 'target';
                } else {
                    category = 'Reach';
                    categoryClass = 'reach';
                }

                const row = document.createElement('tr');
                row.dataset.category = categoryClass;
                row.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${r.name}</td>
                    <td><span class="prob-badge ${categoryClass}">${r.probability}%</span></td>
                    <td><span class="category-label ${categoryClass}">${category}</span></td>
                `;
                tbody.appendChild(row);
            });

            // Show results
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            // Reset filter
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
            document.querySelectorAll('#results-body tr').forEach(row => row.style.display = '');
        });
    </script>
</body>
</html>
